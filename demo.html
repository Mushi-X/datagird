<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="css/index.css" type="text/css" rel="stylesheet"/>

    <title>kyDatagrid Demo</title>
    <style>
        * { margin: 0; padding: 0; }
        body { width: 1000px; margin: 0 auto; }
        h1 { font-size: 40px; text-align: center; margin: 10px 0; }
        h3 { font-size: 16px; text-align: center; margin: 10px 0; }
        h3 a { font-size: 16px; text-align: center; margin: 10px 0; }
    </style>
</head>
<body>
<h1>kyDatagrid Demo</h1>
<h3>Author : <a href="mailto:huzhaobin@kingyea.com.cn">Mushi</a></h3>
<table id="demoTable"></table>
<table id="demoTable2"></table>
</body>

<script src="js/jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="js/template.js" type="text/javascript"></script>
<script src="js/kyDatagrid.min.js" type="text/javascript"></script>
<!-- kyDatagrid 表格模板 -->
<script id="kyDatagrid" type="text/html">
    <!-- 表头 -->
    <tr id="kyDatagrid-header">
        <!-- 是否显示行号 -->
        {{if options.rownumbers}}
        <th style="min-width:36px;max-width:36px;"></th>
        {{/if}}
        <!-- 是否可以复选 -->
        {{if options.enableChecked}}
        <th style="min-width:36px;max-width:36px;text-align: center;">
            <input type="checkbox" id="kyDatagridAllCheckbox"/>
        </th>
        {{/if}}
        {{each options.columns as col index}}
        {{col.title | outputTitle:col,totalWidth,options.queryParams}}
        {{/each}}
    </tr>
    <!-- 表格主体 -->
    {{if rows.length <= 0}}
    <tr>
        {{options.errorMsg | outputEmptyMsg:options}}
    </tr>
    {{else}}
    {{each rows as row index}}
    <tr id="kyDatagrid-row-{{index}}" class="kyDatagrid-row" index="{{index}}">
        <!-- 是否显示行号 -->
        {{if options.rownumbers}}
        <td class="center">{{(options.pageNumber - 1 ) * options.pageSize + index + 1}}</td>
        {{/if}}
        <!-- 是否可以复选 -->
        {{if options.enableChecked}}
        <td class="center">
            <input type="checkbox" class="kyDatagridCheckbox"/>
        </td>
        {{/if}}
        <!-- 遍历每列数据 -->
        {{each options.columns as col j}}
        {{if row[col.field] != undefined}}
        {{row[col.field] | outputContent:row,index,col}}
        {{else}}
        {{"" | outputContent:row,index,col}}
        {{/if}}
        {{/each}}
    </tr>
    {{/each}}
    <!-- 空行遍历 -->
    {{each emptyRows as emptyRow index}}
    <tr class="kyDatagrid-row empty-row">
        {{if options.rownumbers}}
        <td></td>
        {{/if}}
        <!-- 是否可以复选 -->
        {{if options.enableChecked}}
        <td></td>
        {{/if}}
        {{options.pageSize | outputEmptyRow:options}}
    </tr>
    {{/each}}
    {{/if}}
</script>

<!-- kyDatagrid 表格分页模板 -->
<script id="kyDatagridPage" type="text/html">
    <div class="fenye">
        <div class="left list-show">第{{rowBegin}}到{{rowEnd}}条记录，共{{totalCount}}条</div>
        <ul class="right page-box">
            <li class="pre" pageno="{{pageNo-1}}"><a class="{{if pageNo <= 1}}hui{{/if}}" href="javascript:void(0)">上一页</a></li>
            {{each pageScope as page}}
            {{if page==pageNo}}
            <li class="num active" pageno="{{page}}"><a href="javascript:void(0)" class="">{{page}}</a></li>
            {{else}}
            <li class="num" pageno="{{page}}"><a href="javascript:void(0)" class="">{{page}}</a></li>
            {{/if}}
            {{/each}}
            <li class="next" pageno={{pageNo+1}}><a class="{{if pageNo >= totalPage}}hui{{/if}}" href="javascript:void(0)">下一页</a></li>
        </ul>
        <div class=" clearfix"></div>
    </div>
</script>

<script type="text/javascript">
    // 格式化输出表格标题
    template.helper('outputTitle', function (title, column, totalWidth, queryParams) {
        var th = $("<th>");
        th.attr("field", column.field);
        th.html(column.title);
        // 列是否可排序
        if (column.sortable == true) {
            th.addClass("sortable");
            if (column.field == queryParams.sort && queryParams.order == "desc") {
                th.addClass("down");
            }
            else if (column.field == queryParams.sort && queryParams.order == "asc") {
                th.addClass("up");
            }
        }
        // 列是否隐藏
        if (column.hidden == true) {
            th.css("display", "none");
        }

        var titleAlign = column.titleAlign || column.align;
        switch (titleAlign) {
            case 'left':
                th.css("text-align", "left");
                break;
            case 'center':
                th.css("text-align", "center");
                break;
            case 'right':
                th.css("text-align", "right");
                break;
            default:
                th.css("text-align", "left");
                break;
        }
        // 宽度自适应
        var columnWidth = column.width == undefined ? 100 : column.width;
        th.css("width", columnWidth / totalWidth * 100 + "%");

        return th[0].outerHTML;
    });

    // 格式化输出单元格内容
    template.helper('outputContent', function (value, row, index, column) {
        if (column.hidden == true) {
            return "";
        }
        var td = $("<td>");
        // 是否需要格式化输出
        if (column.formatter != undefined && column.formatter != null) {
            td.html(column.formatter(value, row, index))
        }
        else {
            td.html(value);
        }

        switch (column.align) {
            case 'left':
                td.css("text-align", "left");
                break;
            case 'center':
                td.css("text-align", "center");
                break;
            case 'right':
                td.css("text-align", "right");
                break;
            default:
                td.css("text-align", "left");
                break;
        }
        return td[0].outerHTML;
    });

    // 格式化输出空行
    template.helper('outputEmptyRow', function (pageSize, options) {
        var tr = "";
        var columns = options.columns;
        for (var i = 0; i < columns.length; i++) {
            var col = columns[i];
            if (!col.hidden) {
                tr += "<td></td>";
            }
        }
        return tr;
    });

    template.helper('outputEmptyMsg', function (errorMsg, options) {
        var td = $("<td>");
        var columnsLen = options.columns.length;
        if (options.enableChecked) {
            columnsLen++;
        }
        td.attr("colspan", columnsLen);
        td.attr("align", "center");
        td.html(options.errorMsg);
        return td[0].outerHTML;
    });
</script>
<script type="text/javascript">
    $(function () {
        $("#demoTable").kyDatagrid({
            title: "办公设备",
            method: "get",
            url: 'data.json',
            border: true,
            idField: 'id',
            pagination: true,
            singleSelect: false,
            rownumbers: true,
            enableChecked: true,
            pageNumber: 1,
            pageSize: 15,
            columns: [
                {field: 'id', title: 'id', hidden: true},
                {field: 'name', title: '名称', width: 100, sortable: true},
                {
                    field: 'status', title: '状态', width: 100, align: 'center', titleAlign: 'left',
                    formatter: function (val, row, index) {
                        switch (val) {
                            case "1" :
                                return "状态为一";
                                break;
                            case "2" :
                                return "状态为二";
                                break;

                        }
                    }
                },
                {
                    field: 'oper', title: '操作', width: 100,
                    formatter: function (val, row, index) {
                        if (index % 2 == 0) {
                            return "<a class='btn-blue' href='javascript:void(0)' onclick='getSelections()'>按钮</a>"
                        } else {
                            return "<button class='btn-blue' href='javascript:void(0)'>按钮</button>"
                        }
                    }
                }
            ],
            onLoadSuccess: function () {
            },
            onDblClickRow: function (index, row) {
            }
        });
    });


    function getSelections() {
        console.log($("#demoTable").kyDatagrid('getSelections'));
    }
</script>
</html>