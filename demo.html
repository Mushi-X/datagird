<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="css/index.css" type="text/css" rel="stylesheet"/>

    <title>kyTable Demo</title>
    <style>
        * { margin: 0; padding: 0; }
        body { width: 1000px; margin: 0 auto; }
        h1 { font-size: 40px; text-align: center; margin: 10px 0; }
        h3 { font-size: 16px; text-align: center; margin: 10px 0; }
        h3 a { font-size: 16px; text-align: center; margin: 10px 0; }
    </style>
</head>
<body>
<h1>kyTable Demo</h1>
<h3>Author : <a href="mailto:huzhaobin@kingyea.com.cn">Mushi</a></h3>
<table id="demoTable"></table>
</body>

<script src="js/jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="js/template.js" type="text/javascript"></script>
<script src="js/kyTable.js" type="text/javascript"></script>

<!-- kyTable 表格模板 -->
<script id="kyTable" type="text/html">
    <%-- 表头 --%>
    <tr id="kyTable-header">
        <%-- 是否显示行号 --%>
        {{if options.rownumbers}}
        <th style="min-width:36px;max-width:36px;"></th>
        {{/if}}
        <%-- 是否可以复选 --%>
        {{if options.enableChecked}}
        <th style="min-width:36px;max-width:36px;text-align: center;">
            <input type="checkbox" id="kyTableAllCheckbox"/>
        </th>
        {{/if}}
        {{each options.columns as col index}}
        {{col.title | outputTitle:col,totalWidth,options.queryParams}}
        {{/each}}
    </tr>
    <%-- 表格主体 --%>
    {{each rows as row index}}
    <tr id="kyTable-row-{{index}}" class="kyTable-row" index="{{index}}">
        <%-- 是否显示行号 --%>
        {{if options.rownumbers}}
        <td class="center">{{(options.pageNumber - 1 ) * options.pageSize + index + 1}}</td>
        {{/if}}
        <%-- 是否可以复选 --%>
        {{if options.enableChecked}}
        <td class="center">
            <input type="checkbox" class="kyTableCheckbox"/>
        </td>
        {{/if}}
        <%-- 遍历每列数据 --%>
        {{each options.columns as col j}}
        {{if row[col.field] != undefined}}
        {{row[col.field] | outputContent:row,index,col}}
        {{else}}
        {{"" | outputContent:row,index,col}}
        {{/if}}
        {{/each}}
    </tr>
    {{/each}}
    <%-- 空行遍历 --%>
    {{each emptyRows as emptyRow index}}
    <tr class="kyTable-row empty-row">
        {{if options.rownumbers}}
        <%--
        <td class="center">{{(options.pageNumber - 1 ) * options.pageSize + rows.length + index + 1}}</td>
        --%>
        <td></td>
        {{/if}}
        <%-- 是否可以复选 --%>
        {{if options.enableChecked}}
        <td></td>
        {{/if}}
        {{options.pageSize | outputEmptyRow:options}}
    </tr>
    {{/each}}
</script>
<script id="kyTablePage" type="text/html">
    <div class="fenye">
        <div class="left list-show">第{{rowBegin}}到{{rowEnd}}条记录，共{{totalCount}}条</div>
        <ul class="right page-box">
            <li class="pre" pageno="{{pageNo-1}}"><a class="{{if pageNo <= 1}}hui{{/if}}" href="javascript:void(0)">上一页</a></li>
            {{each pageScope as page}}
            {{if page==pageNo}}
            <li class="num active" pageno="{{page}}"><a href="javascript:void(0)" class="">{{page}}</a></li>
            {{else}}
            <li class="num" pageno="{{page}}"><a href="javascript:void(0)" class="">{{page}}</a></li>
            {{/if}}
            {{/each}}
            <li class="next" pageno={{pageNo+1}}><a class="{{if pageNo >= totalPage}}hui{{/if}}" href="javascript:void(0)">下一页</a></li>
        </ul>
        <div class=" clearfix"></div>
    </div>
</script>
<script type="text/javascript">
    // 格式化输出表格标题
    template.helper('outputTitle', function (title, column, totalWidth, queryParams) {
        var th = $("<th>");
        th.attr("field", column.field);
        th.html(column.title);
        // 列是否可排序
        if (column.sortable == true) {
            th.addClass("sortable");
            if (column.field == queryParams.sort && queryParams.order == "desc") {
                th.addClass("down");
            }
            else if (column.field == queryParams.sort && queryParams.order == "asc") {
                th.addClass("up");
            }
        }
        // 列是否隐藏
        if (column.hidden == true) {
            th.css("display", "none");
        }
        // 宽度自适应
        var columnWidth = column.width == undefined ? 100 : column.width;
        th.css("width", columnWidth / totalWidth * 100 + "%");

        return th[0].outerHTML;
    });

    // 格式化输出单元格内容
    template.helper('outputContent', function (value, row, index, column) {
        if (column.hidden == true) {
            return "";
        }
        if (column.formatter != undefined && column.formatter != null) {
            return "<td>" + column.formatter(value, row, index) + "</td>";
        }
        var val = "<td>" + value + "</td>";
        return val;
    });

    // 格式化输出空行
    template.helper('outputEmptyRow', function (pageSize, options) {
        var tr = "";
        var columns = options.columns;
        for (var i = 0;
             i < columns.length;
             i++) {
            var col = columns[i];
            if (!col.hidden) {
                tr += "<td></td>";
            }
        }
        return tr;
    });
</script>

<script type="text/javascript">
    $(function () {
        $("#demoTable").kyTable({
            title: "办公设备",
            method: "get",
            url: 'data.json',
            border: true,
            idField: 'id',
            pagination: true,
            rownumbers: true,
            enableChecked: true,
            pageNumber: 1,
            pageSize: 15,
            columns: [
                {field: 'id', title: 'id', hidden: true},
                {field: 'name', title: '名称', width: 100, sortable: true},
                {
                    field: 'status', title: '状态', width: 100,
                    formatter: function (val, row, index) {
                        switch (val) {
                            case "1" :
                                return "状态为一";
                                break;
                            case "2" :
                                return "状态为二";
                                break;

                        }
                    }
                },
                {
                    field: 'oper', title: '操作', width: 100,
                    formatter: function (val, row, index) {
                        return "<a href='javascript:void(0)'>按钮</a>"
                    }
                }
            ],
            onLoadSuccess: function () {
                alert("nothing to do...");
            },
            onDblClickRow: function (index, row) {
                alert("row index is " + index);
            }
        });
    });
</script>
</html>